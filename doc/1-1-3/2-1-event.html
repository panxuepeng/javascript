<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>测试Dom事件流</title>
</head>
<body>

<input id="myBtn" type="button" value="myBtn"/>
<a id="jqeditor" href="#" target="_blank">连接</a>
<script>
function $(id) {
	return document.getElementById(id);
}

var btn = $("myBtn");

// 测试Dom事件流
// 需要非IE浏览器测试
function FlowofEvent(){
	if(!window.addEventListener){
		return;
	}
	document.body.addEventListener('click', function(){alert("6.冒泡阶段-document.body")}, false);
	document.addEventListener('click', function(){alert("7.冒泡阶段-document")}, false);
	window.addEventListener('click', function(){alert("8.冒泡阶段-window")}, false);

	btn.addEventListener('click', function(){alert('4.捕获阶段-myBtn')}, true);
	btn.addEventListener('click', function(){alert('5.冒泡阶段-myBtn')}, false);

	window.addEventListener('click', function(){alert("1.捕获阶段-window")}, true);
	document.addEventListener('click', function(){alert("2.捕获阶段-document")}, true);
	document.body.addEventListener('click', function(){alert("3.捕获阶段-document.body")}, true);
}

// Dom事件对象
function domEventObject(){
	btn.addEventListener('click', function( e ){
		var target = e.target;
		var keys = [];
		for( var key in e ){
			keys.push(key);
		}
		alert(keys);
		setTimeout(function(){
			var keys = [];
			for( var key in e ){
				keys.push(key);
			}
			alert(keys);
		}, 1000);
	}, false);
}

// IE事件对象
function ieEventObject(){
	btn.attachEvent('onclick', function(){
		var a = "aa";
		var e = event;
		var target = e.srcElement;
		var keys = [];
		for( var key in e ){
			keys.push(key);
		}
		//alert(keys);
		setTimeout(function(){
			var keys = [];
			for( var key in e ){
				keys.push(key);
			}
			//alert(keys);
			
			// 此时 event 对象已经不存在了
			var keys = [];
			for( var key in event ){
				keys.push(key);
			}
			alert(keys); // 空
		}, 2000);
	});
}

// 阻止Dom事件流传播
function stopPropagation(){
	if(!window.addEventListener){
		return;
	}
	
	window.addEventListener('click', function(e){alert("1.捕获阶段-window")}, true);
	document.addEventListener('click', function(e){
		alert("2.捕获阶段-document");
		//e.stopPropagation();
	}, true);
	document.body.addEventListener('click', function(){alert("3.捕获阶段-document.body")}, true);

	btn.addEventListener('click', function(e){
		alert('4.捕获阶段-myBtn');
	}, true);
	btn.addEventListener('click', function(e){
		alert('5.冒泡阶段-myBtn');
		e.stopPropagation();
	}, false);
	
	document.body.addEventListener('click', function(){alert("6.冒泡阶段-document.body")}, false);
	document.addEventListener('click', function(e){
		alert("7.冒泡阶段-document");
	}, false);
	window.addEventListener('click', function(e){
		alert("8.冒泡阶段-window");
	}, false);
}

// 阻止IE事件冒泡
// ....
// event.cancelBubble  = true;

// 阻止非ie浏览器默认行为
function preventDefault(){
	$("jqeditor").addEventListener('click', function(e){
		e.preventDefault();
	}, false);
}

// 阻止ie浏览器默认行为
function returnFalse(){
	$("jqeditor").attachEvent('onclick', function(){
		event.returnValue = false;
	});
}


 //FlowofEvent();

 domEventObject();

 //ieEventObject();

 //stopPropagation();

 //preventDefault();

// returnFalse();

</script>

<script src="lib/jquery-1.4.2.min.js"></script>
<script>
$("a").click(function(){
	setTimeout(function(){alert(3);}, 1000);
	
	return false;
});

$("a").mousedown(function(){
	setTimeout(function(){alert(1);}, 1000);
	return false;
});

$("a").mouseup(function(){
	setTimeout(function(){alert(2);}, 1000);
	return false;
});
</script>
</body>
</html>
